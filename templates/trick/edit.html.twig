{% extends 'base.html.twig' %}

{% block title %}{{ trick.title }}{% endblock %}

{% form_theme form 'bootstrap_5_layout.html.twig' %}

{% block body %}
    <section id="trick-header" class="page-section mt-4">
        <div class="container" style="background-image: url({{ image(trick.featuredImage) }})">
            <h1 class="masthead-heading text-uppercase">{{ trick.title }}</h1>
        </div>
    </section>

    <!-- Services-->
    <section class="page-section" id="services">
        <div class="container">
            {{ form_start(form) }}
            {{ form_row(form.title) }}
            {{ form_row(form.slug) }}
            {{ form_row(form.description) }}
            {{ form_row(form.content) }}


            <h3>Images</h3>
            <div class="images" data-index="{{ form.images|length > 0 ? form.images|last.vars.name + 1 : 0 }}"
                data-prototype="{{ form_widget(form.images.vars.prototype)|e('html_attr') }}">
                {% for image in form.images %}
                    <div>{{ form_row(image) }}</div>
                {% endfor %}
            </div>
            <button type="button" class="btn-primary btn add_item_link" data-collection-holder-class="images">Ajouter une image</button>

            <h3>Videos</h3>
            <div class="videos" data-index="{{ form.videos|length > 0 ? form.videos|last.vars.name + 1 : 0 }}"
                data-prototype="{{ form_widget(form.videos.vars.prototype)|e('html_attr') }}">
                {% for video in form.videos %}
                    <div>{{ form_row(video) }}</div>
                {% endfor %}
            </div>
            <button type="button" class="btn-primary btn add_item_link" data-collection-holder-class="videos">Ajouter une vid√©o</button>

            {{ form_end(form) }}
        </div>
    </section>
    <script>
        const addFormToCollection = (e) => {
            const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

            const item = document.createElement('div');

            item.innerHTML = collectionHolder
                .dataset
                .prototype
                .replace(
                    /__name__/g,
                    collectionHolder.dataset.index
                );

            collectionHolder.appendChild(item);

            collectionHolder.dataset.index++;

            addTagFormDeleteLink(item);
        };

        const addTagFormDeleteLink = (tagFormLi) => {
            const removeFormButton = document.createElement('button')
            removeFormButton.classList.add('btn-primary')
            removeFormButton.classList.add('btn')
            removeFormButton.innerText = 'Supprimer'

            tagFormLi.append(removeFormButton);

            removeFormButton.addEventListener('click', (e) => {
                e.preventDefault()
                // remove the li for the tag form
                tagFormLi.remove();
            });
        }

        const images = document.querySelectorAll('div.images > div')
        images.forEach((image) => {
            addTagFormDeleteLink(image)
        })

        document
            .querySelectorAll('.add_item_link')
            .forEach(btn => btn.addEventListener("click", addFormToCollection));
    </script>
{% endblock %}
